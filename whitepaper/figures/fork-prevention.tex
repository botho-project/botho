% Fork Prevention Diagram
% Contrasts Bitcoin's probabilistic finality with Botho's deterministic finality
%
% ACCESSIBILITY ALT TEXT:
% A comparison diagram with two blockchain timelines. Top (Bitcoin): Shows
% a chain with green blocks B1-B3, yellow uncertain blocks B4-B6, and a
% red orphaned fork B3'-B4'. Label indicates 10-60 minute probabilistic
% finality. Bottom (Botho): Shows a single chain of green finalized blocks
% B1-B5 with checkmarks, and one pending block B6. Each block is immediately
% final. Text explains that SCP quorum intersection mathematically prevents
% any alternative history, enabling instant settlement.

\begin{figure}[ht]
\centering
\begin{tikzpicture}[
    node distance=0.6cm,
    block/.style={rectangle, draw, minimum width=1.2cm, minimum height=0.8cm, font=\scriptsize},
    main/.style={block, fill=green!30},
    orphan/.style={block, fill=red!20, draw=red!50},
    pending/.style={block, fill=yellow!20, draw=yellow!50},
    finalized/.style={block, fill=green!50, draw=green!70, thick},
    arrow/.style={->, >=stealth, thick},
]

% === Bitcoin (top) ===
\node[font=\bfseries\small] at (-5.5,3) {Bitcoin (Nakamoto Consensus)};

% Main chain
\node[main] (b1) at (-4,2) {B1};
\node[main] (b2) at (-2.5,2) {B2};
\node[main] (b3) at (-1,2) {B3};
\node[pending] (b4) at (0.5,2) {B4};
\node[pending] (b5) at (2,2) {B5?};
\node[pending] (b6) at (3.5,2) {B6?};

% Fork
\node[orphan] (f1) at (-1,3.2) {B3'};
\node[orphan] (f2) at (0.5,3.2) {B4'};

% Arrows
\draw[arrow] (b1) -- (b2);
\draw[arrow] (b2) -- (b3);
\draw[arrow] (b3) -- (b4);
\draw[arrow] (b4) -- (b5);
\draw[arrow] (b5) -- (b6);
\draw[arrow, red!50] (b2) -- (f1);
\draw[arrow, red!50] (f1) -- (f2);

% Annotations
\node[font=\scriptsize, red!60] at (-0.25,3.8) {Orphaned fork};
\node[font=\scriptsize, align=center] at (2.75,1.2) {Probabilistic finality\\(wait 6+ blocks)};
\draw[decorate, decoration={brace, amplitude=3pt, mirror}]
    (b4.south west) -- (b6.south east)
    node[midway, below=5pt, font=\scriptsize] {Uncertain};

% === Botho (bottom) ===
\node[font=\bfseries\small] at (-5.5,-0.5) {\Botho\ (PoW + SCP)};

% Single chain with finality markers
\node[finalized] (s1) at (-4,-1.5) {B1};
\node[finalized] (s2) at (-2.5,-1.5) {B2};
\node[finalized] (s3) at (-1,-1.5) {B3};
\node[finalized] (s4) at (0.5,-1.5) {B4};
\node[finalized] (s5) at (2,-1.5) {B5};
\node[pending] (s6) at (3.5,-1.5) {B6};

% Finality markers
\foreach \x in {s1,s2,s3,s4,s5} {
    \node[font=\tiny, green!50!black] at ($(\x.south)+(0,-0.3)$) {\checkmark};
}

% Arrows
\draw[arrow] (s1) -- (s2);
\draw[arrow] (s2) -- (s3);
\draw[arrow] (s3) -- (s4);
\draw[arrow] (s4) -- (s5);
\draw[arrow] (s5) -- (s6);

% SCP finalization box
\draw[dashed, thick, blue!50, rounded corners] ($(s6.north west)+(-0.2,0.4)$) rectangle ($(s6.south east)+(0.2,-0.2)$);
\node[font=\scriptsize, blue!50] at (3.5,-0.8) {SCP finalizing};

% No fork annotation
\draw[thick, red, ->] (0.5,-3) -- (0.5,-2.5);
\node[font=\scriptsize, align=center] at (0.5,-3.4) {Fork impossible:\\quorum intersection\\prevents divergence};

% Comparison annotations
\node[align=left, font=\scriptsize, anchor=west] at (5,-0.5) {
    \textbf{Key difference:}\\
    Once SCP externalizes\\
    a block, it cannot be\\
    reverted---even by a\\
    51\% attack.
};

% Timing comparison
\node[align=left, font=\scriptsize] at (-4.5,-3.5) {
    Bitcoin: 10--60 min for ``confidence''\\
    \Botho: 5 sec for \textit{absolute} finality
};

\end{tikzpicture}
\caption{Fork prevention comparison. Bitcoin (top) achieves only probabilistic
finality---transactions can be reversed by reorganizations, requiring multiple
confirmations for confidence. \Botho (bottom) achieves deterministic finality
via SCP: once a block is externalized, quorum intersection mathematically
guarantees no alternative history can exist. This enables instant settlement
with no risk of reversal.}
\label{fig:fork-prevention}
\end{figure}
